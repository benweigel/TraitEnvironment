## ----setup, include=FALSE--------------------------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE)


## ---- message=FALSE--------------------------------------------------------------------------------------------------------------------
library(ade4)


## ---- message=FALSE--------------------------------------------------------------------------------------------------------------------
library(ggplot2)


## --------------------------------------------------------------------------------------------------------------------------------------
load("NEAtl_FishTraitEnv.Rdata")


## --------------------------------------------------------------------------------------------------------------------------------------
all(row.names(abu)==row.names(env))
all(colnames(abu)==row.names(trait))


## --------------------------------------------------------------------------------------------------------------------------------------
dim(trait)
names(trait)


## --------------------------------------------------------------------------------------------------------------------------------------
dim(env)
names(env)


## --------------------------------------------------------------------------------------------------------------------------------------
coa.abu <- dudi.coa(abu, scannf = FALSE, nf=2)


## --------------------------------------------------------------------------------------------------------------------------------------
pca.trait <- dudi.pca(trait, scannf = FALSE, 
                      row.w = coa.abu$cw)


## --------------------------------------------------------------------------------------------------------------------------------------
pca.env <- dudi.pca(env, scannf = FALSE, 
                     row.w = coa.abu$lw)


## --------------------------------------------------------------------------------------------------------------------------------------
rlqF <- rlq(pca.env, coa.abu, pca.trait, 
            scannf = FALSE)

summary(rlqF)


## --------------------------------------------------------------------------------------------------------------------------------------
#Plot traits score
t1 <- order(rlqF$c1[,1])
dotchart(rlqF$c1[t1,1], pch=16, 
         labels = names(trait)[t1])
abline(v=0, lty=2)


## --------------------------------------------------------------------------------------------------------------------------------------
# top 10 species with positive score
rlqF$mQ[order(rlqF$mQ[,1], decreasing = TRUE)[1:10],]

# top 10 species with negative score
rlqF$mQ[order(rlqF$mQ[,1])[1:10],]


## --------------------------------------------------------------------------------------------------------------------------------------
#Plot environment score
e1 <- order(rlqF$l1[,1])
dotchart(rlqF$l1[e1,1], pch=16,
         labels = names(env)[e1])
abline(v=0, lty=2)


## --------------------------------------------------------------------------------------------------------------------------------------
# Choice of diverging color scale
colpal <- terrain.colors(7)[-7]
# or from RColorBrewer package
# colpal <- rev(RColorBrewer::brewer.pal(6,"RdYlBu")) 

mapggplot(coo[,1], coo[,2], rlqF$lR[,1], 
          colpal, main="RLQ1")

